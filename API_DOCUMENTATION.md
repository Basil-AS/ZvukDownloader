
# Документация API SberZvuk (используемые запросы)

Краткое описание запросов, которые использует утилита. Примеры обезличены.

## База и аутентификация
- База: `https://zvuk.com/api`
- Аутентификация: cookie `auth` с токеном (берётся из `config.json`), HTTPS
- Формат: JSON

## Эндпоинты

### Профиль пользователя
- `GET /v2/tiny/profile`
- Назначение: базовая информация аккаунта, подписки и возможностей
  - Токен `auth` (где взять):
    1) Откройте `https://zvuk.com` в браузере (выполните вход).
    2) DevTools → Application → Cookies → `https://zvuk.com` → найдите cookie `auth`.
    3) Либо проверьте `GET https://zvuk.com/api/v2/tiny/profile` (при активной сессии).
    4) Передайте токен через `--token` или поместите в `config.json` как `"auth_token"`.
    - Пример значения токена (формат, пример обезличен): `true,"token":"068c44b5db8f4d8c80003cc8b3ea78f5"`
- Пример (обезличено, расширено):
```json
{
  "result": {
    "profile": {
      "id": 1234567,
      "name": "Account Name",
      "login": "user@example.com",
      "avatar": { "src": "https://cdn..../pic?id=..." },
      "region": "RU"
    },
    "subscription": {
      "status": "confirmed",
      "tariff": "plus",
      "expire": 1735689600000
    },
    "features": {
      "can_flac": true,
      "can_lyrics": true
    }
  }
}
```

### Информация о треках
- `GET /tiny/tracks?ids=<id1,id2>&include=track`
- Назначение: подробные данные по трекам (названия, исполнители, длительность, жанры, наличие FLAC и т.д.)
- Ответ содержит словарь `tracks` c объектами треков

### Информация о релизах (альбомах)
- `GET /tiny/releases?ids=<id1,id2>&include=track`
- Назначение: информация по альбомам + список `track_ids`

### Информация о плейлистах
- `GET /tiny/playlists?ids=<id1,id2>`
- Назначение: базовые сведения о плейлистах

### Стримовая ссылка (аудио)
- `GET /tiny/track/stream?id=<track_id>&quality=<flac|high|mid>`
- Назначение: получить временную ссылку на поток для скачивания
- Ответ содержит `result.stream` (URL) и `result.expire` (время истечения в мс)
- Особенности:
  - FLAC часто отдаётся с путём типа `/streamfl`
  - Ссылки ограничены по времени (обычно до 24 ч)

### Тексты песен
- `GET /tiny/lyrics?track_id=<track_id>`
- Назначение: получить текст песни; возможны два формата:
  - простой текст (plain)
  - текст с таймкодами (LRC-подобный)
- Утилита умеет:
  - распознавать LRC, сохранять `.lrc`, конвертировать в `.srt`, и добавлять теги в файл:
    - MP3: `SYLT` (синхронизированный, язык `rus`) + дублирующий `USLT` (desc='LRC', текст = LRC)
    - FLAC: `LYRICS` — при наличии LRC пишется LRC текст целиком, иначе обычный текст

### GraphQL (расширенные выборки)
- `POST /v1/graphql`
- Примеры использования:
  - Список релизов по артисту (с пагинацией)
  - Получение базовой информации об артисте

Пример: релизы артиста (используется CLI, постранично по 50):
```json
{
  "query": "query($id: ID!, $limit: Int!, $offset: Int!){ getArtists(ids: [$id]){ releases(limit:$limit, offset:$offset){ id } } }",
  "variables": { "id": "ARTIST_ID", "limit": 50, "offset": 0 }
}
```

Пример: базовая информация об артисте (для документации/расширения CLI):
```json
{
  "query": "query($id: ID!){ getArtists(ids: [$id]){ id name image{src} } }",
  "variables": { "id": "ARTIST_ID" }
}
```

## Качества аудио
- FLAC (lossless): `quality=flac`
- MP3 (320/128): `quality=high|mid`

Примечания по доступности качества и альбомов:
- Доступность форматов зависит от подписки и прав. Для каждого трека скрипт проверяет `flac|high|mid` и подбирает лучшее из доступных.
- Для проверки всего альбома используйте CLI команду проверки: `python zvuk_multibot.py chkr <release_id>`.

## Ограничения и ошибки
- Требуется авторизация (401 при отсутствии)
- Доступ к контенту зависит от подписки/региона (403)
- Контент может отсутствовать (404)
- Ограничения частоты (429)

## Пример сценария скачивания
1) `GET /tiny/tracks?ids=<id>` — метаданные трека
2) `GET /tiny/track/stream?id=<id>&quality=flac` — ссылка на поток
3) Скачивание по `result.stream`
4) `GET /tiny/lyrics?track_id=<id>` — текст (plain/LRC)
5) Встраивание тегов (SYLT/USLT для MP3, LYRICS для FLAC) и (опционально) сохранение `.lrc` / `.srt`

## Примечания
- Таймкоды (LRC) могут отличаться по формату; утилита нормализует в `[mm:ss.xx]`
- Для больших выборок (артист → релизы) используется GraphQL с пагинацией (`limit`, `offset`).
- В CLI для артиста доступна команда `artist-info` и скачивание `download-artist (dla)`; при большом каталоге задайте высокий `--limit`.
